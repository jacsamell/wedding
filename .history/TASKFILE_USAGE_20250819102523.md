# Taskfile Usage Guide

This project uses [Task](https://taskfile.dev/) as a task runner to simplify development and deployment workflows.

## Installation

If you don't have Task installed:

```bash
# macOS (using Homebrew)
brew install go-task/tap/go-task

# Or using npm globally
npm install -g @go-task/cli
```

## Core Commands

### 🚀 **Development**
```bash
task start          # Start development server (localhost:3000)
task dev            # Complete development setup
```

### 🔨 **Building**
```bash
task build          # Build everything (frontend + lambdas)
task build:frontend # Build only the website
task build:lambda   # Build only Lambda functions
```

### 📦 **Deployment**
```bash
task deploy         # Full deployment (builds first)
task deploy:plan    # Show what will be deployed
task deploy:apply   # Deploy without confirmation
```

## Complete Workflows

### 🚢 **Ship to Production** (One Command Deployment)
```bash
task ship
```
This runs the complete deployment pipeline:
1. Builds frontend and Lambda functions
2. Deploys infrastructure with Terraform
3. Syncs website to S3
4. Invalidates CloudFront cache
5. Your wedding website is live! 🎉

### 🛠️ **First-Time Setup**
```bash
task setup                # Install all dependencies
task setup:terraform      # Setup Terraform config
```

## Utility Commands

### 🧹 **Maintenance**
```bash
task clean              # Clean all build artifacts
task lint               # Run TypeScript/ESLint checks
task type-check         # Run TypeScript type checking
task preview            # Preview built website locally
```

### 🏗️ **Infrastructure**
```bash
task infra:init         # Initialize Terraform
task infra:validate     # Validate Terraform config
task infra:destroy      # Destroy infrastructure (careful!)
```

### 🔍 **Monitoring**
```bash
task logs:lambda           # Stream Lambda function logs
task invalidate:cloudfront # Invalidate CloudFront cache
task sync:s3              # Sync website to S3 bucket
```

## Available Tasks

Run `task --list` to see all available tasks with descriptions.

## Prerequisites

Before running deployment tasks, make sure you have:

1. **AWS CLI configured** with appropriate permissions
2. **Terraform variables configured**: Copy `terraform/terraform.tfvars.example` to `terraform/terraform.tfvars` and fill in your values
3. **Spotify API credentials** (for the Spotify integration)

## Quick Start

```bash
# First time setup
task dev

# Start developing
task start

# When ready to deploy
task ship
```

## Environment Files

- `terraform/terraform.tfvars` - Your Terraform variables (create from `.example`)
- `server/spotify-api.ts` - Configure your Spotify API credentials

## Examples

```bash
# Development workflow
task start                    # Start dev server

# Check your work
task lint                     # Verify code quality
task build                    # Test build process

# Deploy when ready
task deploy:plan             # Review changes
task deploy                  # Deploy to production

# Or deploy everything at once
task ship                    # Complete deployment pipeline
```

## Troubleshooting

- **Task not found**: Install Task using the instructions above
- **Terraform errors**: Run `task setup:terraform` first
- **Build failures**: Run `task clean` then `task build`
- **AWS permissions**: Ensure your AWS CLI is configured with proper permissions

## File Structure

The Taskfile manages these key directories:
- `src/` - Frontend TypeScript/CSS source code
- `lambda-rsvp/` - RSVP Lambda function
- `lambda-spotify/` - Spotify integration Lambda
- `terraform/` - Infrastructure as code
- `dist/` - Built website (generated)
